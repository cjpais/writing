<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../static/main.css">
    <link rel="stylesheet" href="static/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Handling Universal Links in SwiftUI</title>
  </head>

  <body class="container">
    <h1>Handling Universal Links in SwiftUI</h1>
<p><em>Last Updated: Nov 2020</em></p>
<p><em>iOS SDK 14.2</em></p>
<p>I struggled for a long time to figure out how to implement Universal Links properly. In addition there was very little documentation on how you open into your app from a QR code. This guide serves as a way to implement the base level of Universal Link functionality as well as handling QR codes.</p>
<h2>Overview</h2>
<p><a href="https://developer.apple.com/ios/universal-links/">Universal Links</a> allow you to redirect users from a webpage directly into your app‚Äôs context. It is applicable only for iOS devices. With Universal Links you can maintain the context the user previously had on the webpage but give them a native experience.</p>
<p>By adding a specific file (<code>apple-app-site-association</code>) on your webserver, you can support Universal Links relatively easily. When your app is downloaded the user‚Äôs device will query your server for this file. Once it‚Äôs done this, any time the user visits one of the routes provided in this file, they will be directed into your native experience.</p>
<p><strong>Steps to Implement</strong></p>
<ol type="1">
<li>Add Apple App Site Association (AASA)
<ul>
<li>Get Team ID</li>
<li>Validate AASA</li>
</ul></li>
<li>Add Entitlements to App</li>
<li>Use onOpenURL to handle Links</li>
<li>Use onContinueUserActivity to handle QR Codes</li>
<li>Handle Routing</li>
<li>Testing Universal Links
<ul>
<li>Notes Link</li>
<li>Web Link</li>
<li>QR Link</li>
</ul></li>
</ol>
<h2>Adding Apple App Site Association</h2>
<p>Before working on the App at all we want to have everything set up for the app to support our Universal Link. The first thing to do is create the <code>apple-app-site-association</code> (AASA) and serve it.</p>
<p>For example <a href="https://digitaldirtbag.xyz/apple-app-site-association">my AASA</a> looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="dt">&quot;applinks&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    <span class="dt">&quot;apps&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>      <span class="fu">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>        <span class="dt">&quot;appID&quot;</span><span class="fu">:</span> <span class="st">&quot;UWFLB4GC25.com.pais.rockaholic&quot;</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>        <span class="dt">&quot;paths&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;/route/*&quot;</span><span class="ot">]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>      <span class="fu">}</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>    <span class="ot">]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  <span class="fu">},</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>  <span class="dt">&quot;activitycontinuation&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    <span class="dt">&quot;apps&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>      <span class="st">&quot;UWFLB4GC25.com.pais.rockaholic&quot;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    <span class="ot">]</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>  <span class="fu">}</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="fu">}</span></span></code></pre></div>
<p>Breaking this down you only need to do two things.</p>
<ol type="1">
<li>Change the <code>appID</code> to be your <code>TEAM_ID.APP_BUNDLE_ID</code>
<ul>
<li>My <code>TEAM_ID = UWFLB4GC25</code></li>
<li>My <code>APP_BUNDLE_ID = com.pais.rockaholic</code></li>
</ul></li>
<li>Change the <code>paths</code> to be the URL‚Äôs you want to treat as universal links.
<ul>
<li>I will be handling all paths starting with <code>route</code></li>
<li>For more information see <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html">Apple‚Äôs Documentation</a> (it‚Äôs quite good)</li>
</ul></li>
</ol>
<p>The requirements for serving it are as follows:</p>
<ul>
<li>Have it named <code>apple-app-site-association</code></li>
<li>Have it served over HTTPS</li>
<li>Have it served with the <code>Content-Type</code> header set to <code>application/json</code></li>
<li>Have it be valid JSON</li>
<li>Have it served at the root directory or <code>/.well-known</code> directory</li>
</ul>
<h3>Validating AASA</h3>
<p>There are a few tools you can use to validate your AASA after you have it on your server. Even if you validate your AASA you may run into some frustration, but it is a good thing to check off your list.</p>
<p>The <a href="https://branch.io/resources/aasa-validator/">Branch AASA Validator</a> is the best I found. Just put in your domain and it will check everything for you. You should see all green like the below if it‚Äôs good!</p>
<p><img src="aasa_valid.png" /></p>
<p><a href="https://search.developer.apple.com/appsearch-validation-tool">Apple has their own validation tool</a>, however it doesn‚Äôt think my App is valid ü§∑üèΩ‚Äç‚ôÇÔ∏è. I wouldn‚Äôt recommend it. It just added to the confusion of the process.</p>
<h3>References</h3>
<p><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html">Support Universal Links - Apple</a></p>

  </body>

</html>